@page "/filetransfer"

@using Microsoft.AspNetCore.Components.Forms
@using BlazorApp2Test.FileAccess

@inject IWebHostEnvironment Environment


<InputFile OnChange="HandleSelection" /><br />
<button @onclick="Upload" disabled="@(!fileSelected)">Upload</button>
<br />
<br />
<button @onclick="RefreshPage">Refresh</button>

@if(_file != null)
{
    @if (_file.Error != null)
    {
        <p class="text-danger">@_file.Error</p>
    }

    @if (_file.IsUploaded)
    {
        <p class="text-success">File uploaded successfully.</p>
    }

    @if (System.IO.File.Exists(_file.FilePath))
    {
        <a href="/UploadFile/iis.png" download="@_file.FileName">@_file.FilePath</a>
    }
    else
    {
        <p>Sorry, that file does not exist.</p>
    }
}


@code {

    private IBrowserFile selectedFile;
    private bool fileSelected = false;

    // new file obj instance
    private FileAccess _file = new FileAccess();

    void HandleSelection(InputFileChangeEventArgs e)
    {
        selectedFile = e.File;
        if (selectedFile != null)
        {
            fileSelected = true;
        }
    }

    private async Task Upload()
    {
         await _file.UploadFile(selectedFile);
    }

    private void RefreshPage()
    {
        StateHasChanged();
    }
}
